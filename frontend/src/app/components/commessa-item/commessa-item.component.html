<div class="appuntamenti-wrapper">
  
  <div class="appuntamenti-header">
    <div class="label-container">
      <ion-icon name="calendar-outline"></ion-icon>
      <span>APPUNTAMENTI</span>
    </div>
    
    <ion-button 
      *ngIf="hasManagerAccess" 
      size="small" 
      fill="outline" 
      shape="round" 
      (click)="nuovoAppuntamento()">
      <ion-icon name="add" slot="start"></ion-icon>
      Nuovo
    </ion-button>
  </div>

  <div *ngIf="!commessa.appuntamenti?.length" class="no-appuntamenti">
    Nessun appuntamento registrato.
  </div>

  <div class="app-list">
    <div 
      class="app-card" 
      *ngFor="let app of commessa.appuntamenti" 
      [class.highlight-item]="app.id == targetAppuntamentoId"
    >
      <div class="date-box">
        <span class="day">{{ getGiorno(app.data_ora) }}</span>
        <span class="month">{{ getMese(app.data_ora) | uppercase }}</span>
        <span class="year">{{ getAnno(app.data_ora) }}</span>
      </div>

      <div class="info-box">
        <div class="time-row">
          <ion-icon name="time-outline"></ion-icon>
          <span class="time">{{ getOra(app.data_ora) }}</span>
        </div>

        <div class="notes-box" *ngIf="app.descrizione">
          {{ app.descrizione }}
        </div>
      </div>

      <div class="actions-box" *ngIf="hasManagerAccess">
        <ion-button
          fill="clear"
          color="medium"
          size="small"
          (click)="modificaApp(app); $event.stopPropagation()"
        >
          <ion-icon name="pencil" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button
          fill="clear"
          color="danger"
          size="small"
          (click)="eliminaApp(app); $event.stopPropagation()"
        >
          <ion-icon name="trash" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>

  <div class="attachments-section ion-margin-top" *ngIf="commessa.allegati?.length">
    <div class="appuntamenti-header">
      <div class="label-container">
        <ion-icon name="attach-outline"></ion-icon>
        <span>ALLEGATI ({{ commessa.allegati?.length }})</span>
      </div>
    </div>

    <ion-list lines="none" class="files-list">
      <ion-item *ngFor="let file of commessa.allegati" class="file-item">
        <div slot="start" class="file-icon">
          <ion-icon name="document-text-outline"></ion-icon>
        </div>
        <ion-label>
          <h3>{{ file.nome_file }}</h3>
          <p>{{ file.data_caricamento | date:'dd/MM/yyyy' }}</p>
        </ion-label>
        
        <ion-buttons slot="end">
          <ion-button color="primary" (click)="scaricaAllegato(file)">
            <ion-icon name="cloud-download-outline" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button *ngIf="hasManagerAccess" color="danger" (click)="eliminaAllegato(file)">
            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-list>
  </div>

</div>